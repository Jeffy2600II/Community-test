<header class="site-header" role="banner">
  <div class="container header-inner">
    <!-- Top row: logo + mobile toggles -->
    <div class="header-top" role="presentation">
      <a class="logo" href="/" aria-label="COMMUNITY home">
        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" aria-hidden="true" class="logo-mark" focusable="false">
          <rect width="24" height="24" rx="6" fill="#2f80ed"></rect>
          <path d="M7 13h10M7 9h10" stroke="#fff" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"></path>
        </svg>
        <div class="brand-wrap" aria-hidden="true">
          <div class="brand">COMMUNITY</div>
          <div class="tagline">พื้นที่แลกเปลี่ยนความรู้</div>
        </div>
      </a>

      <div style="display:flex;align-items:center;gap:8px;">
        <!-- Sidebar toggle (mobile) - new: opens off-canvas sidebar on small screens -->
        <button id="mobileSidebarToggle" class="btn btn-icon" aria-expanded="false" aria-controls="mobileSidebar" aria-label="Toggle sidebar" title="เมนู">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#1f2a37" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M3 12h18M3 6h18M3 18h18"></path>
          </svg>
        </button>

        <!-- Mobile menu toggle: toggles header-bottom (search/actions) as before -->
        <button id="mobileMenuToggle" class="btn btn-icon" aria-expanded="false" aria-controls="headerBottom" aria-label="Toggle menu" title="ค้นหา/การตั้งค่า">
          <!-- hamburger icon (slightly different intent) -->
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#1f2a37" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M4 7h16M4 12h16M4 17h16"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Bottom row: search + dynamic nav/actions (this will be toggled on mobile) -->
    <div id="headerBottom" class="header-bottom" role="navigation" aria-label="Site actions">
      <div class="header-search" role="search" aria-label="Site search">
        <form onsubmit="event.preventDefault(); const q=this.query.value.trim(); if(q) location.href='/search?q='+encodeURIComponent(q);">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 21l-4.35-4.35" stroke="#97a0b3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
          <input type="search" name="query" placeholder="ค้นหาบทความ ผู้ใช้งาน หรือแท็ก" aria-label="ค้นหา">
        </form>
      </div>

      <!-- navBar is populated by JS (accounts/actions/notifications) -->
      <div id="navBar" class="header-actions" aria-hidden="false"></div>
    </div>
  </div>
</header>

<!-- Mobile off-canvas sidebar container (new) -->
<aside id="mobileSidebar" class="mobile-sidebar" aria-hidden="true" role="dialog" aria-label="Mobile menu">
  <div class="mobile-sidebar-inner" tabindex="-1" role="document">
    <!-- navBar will be moved here in JS on mobile; fallback content -->
    <nav class="sidebar-fallback" aria-hidden="true">
      <a href="/" class="small-link">หน้าแรก</a>
      <a href="/post/create" class="small-link">สร้างโพสต์</a>
    </nav>
  </div>
</aside>